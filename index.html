<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Runner</title>
  <style>
    :root{
      --bg:#0f172a;/* slate-900 */
      --panel:#111827ee;/* gray-900 */
      --accent:#22d3ee;/* cyan-400 */
      --accent2:#a78bfa;/* violet-400 */
      --text:#e5e7eb;/* gray-200 */
      --danger:#fb7185;/* rose-400 */
      --success:#34d399;/* emerald-400 */
    }
    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial; 
      background: radial-gradient(1200px 600px at 50% -100px, #1e293b 0%, var(--bg) 60%);
      color:var(--text); display:flex; align-items:center; justify-content:center;
    }
    .wrap{
      width:100%; max-width:520px; aspect-ratio:9/16; position:relative; 
      border-radius:24px; overflow:hidden; box-shadow:0 20px 60px #0008, inset 0 0 0 1px #fff1;
      background:linear-gradient(180deg,#0b1020,#0f172a 40%);
    }
    header{
      position:absolute; top:0; left:0; right:0; padding:10px 12px; display:flex; gap:8px; align-items:center; justify-content:space-between; z-index:3;
      background:linear-gradient(to bottom, #0008, #0000);
    }
    .btn{
      appearance:none; border:0; padding:10px 14px; border-radius:14px; font-weight:700; color:#0b1020; background:var(--accent);
      box-shadow:0 6px 18px #22d3ee55; cursor:pointer; touch-action:manipulation; user-select:none; font-size:14px;
    }
    .btn.alt{ background:var(--accent2); box-shadow:0 6px 18px #a78bfa55; }
    .btn.ghost{ background:#0000; color:var(--text); border:1px solid #fff2; box-shadow:none; }
    .hud{ display:flex; gap:8px; align-items:center; }
    .tag{ padding:8px 12px; border-radius:12px; background:#0006; border:1px solid #fff2; font-weight:600; font-variant-numeric:tabular-nums; }

    canvas{ position:absolute; inset:0; width:100%; height:100%; display:block; }

    .tapzone{
      position:absolute; inset:0; display:grid; grid-template-columns:1fr 1fr; z-index:2; opacity:.001; /* invis√≠vel mas clic√°vel */
    }
    .tapzone > div{ touch-action:none; }

    .center-ui{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:16px; text-align:center; z-index:4;
    }
    .card{ background:var(--panel); border:1px solid #fff2; padding:20px; border-radius:20px; backdrop-filter:blur(8px); width:min(86%,380px); }
    .title{ font-size:28px; font-weight:900; letter-spacing:.3px; }
    .muted{ opacity:.75; font-size:14px; }

    .progress{ height:8px; background:#ffffff1a; border-radius:999px; overflow:hidden; border:1px solid #ffffff26; }
    .bar{ height:100%; width:0%; background:linear-gradient(90deg,var(--accent),var(--accent2)); }

    /* Pequenas dicas na base */
    footer.info{
      position:absolute; bottom:8px; left:0; right:0; text-align:center; font-size:12px; opacity:.7; z-index:1;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="hud">
        <div class="tag" id="scoreTag">üèÜ 0</div>
        <div class="tag" id="bestTag">‚≠ê 0</div>
        <div class="tag" id="speedTag">‚ö° 1.0x</div>
      </div>
      <div class="hud">
        <button class="btn ghost" id="pauseBtn" aria-label="Pausar">‚è∏Ô∏è</button>
        <button class="btn alt" id="resetBtn" aria-label="Reiniciar">üîÑ</button>
      </div>
    </header>

    <canvas id="game"></canvas>

    <!-- zonas de toque: esquerda = deslizar/abaixar, direita = pular -->
    <div class="tapzone" aria-hidden="true">
      <div id="zoneLeft"></div>
      <div id="zoneRight"></div>
    </div>

    <div class="center-ui" id="overlay">
      <div class="card">
        <div class="title">Runner</div>
        <p class="muted">Toque √† direita para <b>pular</b>. Toque e segure √† esquerda para <b>abaixar</b>.
        Desvie dos obst√°culos, colete orbes e fa√ßa a maior pontua√ß√£o!</p>
        <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:10px;">
          <button class="btn" id="startBtn">Come√ßar ‚ñ∂</button>
          <button class="btn ghost" id="muteBtn">üîä Som</button>
        </div>
      </div>
    </div>

    <footer class="info">Dica: pulo duplo est√° ativo. Vibra√ß√£o curta quando voc√™ acerta um orbe.</footer>
  </div>

<script>
(() => {
  // ======= Configura√ß√µes b√°sicas =======
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const dpr = Math.max(1, Math.min(window.devicePixelRatio || 1, 2));
  const state = {
    running:false, paused:false, t:0, last:0, dt:0,
    width: 360, height: 640,
    groundY: 0,
    speed: 240, // px/s base
    speedMul: 1,
    score:0, best: Number(localStorage.getItem('bestScoreRF')||0),
    gravity: 1400,
    jumpVel: -520,
    doubleJump:true,
    muted:false
  };

  // ======= Entidades =======
  const player = { x:72, y:0, w:36, h:48, vy:0, onGround:false, crouch:false, doubleReady:true, color:'#22d3ee' };
  const obstacles = []; // {x,y,w,h,speed,color,type}
  const orbs = []; // colecion√°veis
  const particles = [];

  // ======= Utilidades =======
  function rand(a,b){ return Math.random()*(b-a)+a; }
  function clamp(v,a,b){ return Math.max(a, Math.min(b,v)); }
  function rectsOverlap(a,b){ return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y; }
  function vibe(ms=10){ if(navigator.vibrate) navigator.vibrate(ms); }

  // Sons m√≠nimos via WebAudio (bips)
  const audioCtx = new (window.AudioContext||window.webkitAudioContext||function(){})();
  function beep(freq=660, dur=0.06, type='sine', vol=0.03){
    if(state.muted || !audioCtx.createOscillator) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq; g.gain.value = vol; o.connect(g); g.connect(audioCtx.destination);
    o.start(); setTimeout(()=>o.stop(), dur*1000);
  }

  // ======= Layout e escala =======
  function resize(){
    const rect = canvas.getBoundingClientRect();
    state.width = Math.round(rect.width * dpr);
    state.height = Math.round(rect.height * dpr);
    canvas.width = state.width; canvas.height = state.height;
    state.groundY = state.height * 0.78;
  }
  addEventListener('resize', resize, {passive:true});
  resize();

  // ======= Controles =======
  const zoneL = document.getElementById('zoneLeft');
  const zoneR = document.getElementById('zoneRight');

  function jump(){
    if(player.onGround){ player.vy = state.jumpVel; player.onGround=false; player.doubleReady=true; beep(800,0.05,'triangle'); }
    else if(state.doubleJump && player.doubleReady){ player.vy = state.jumpVel*0.9; player.doubleReady=false; beep(950,0.05,'sawtooth'); }
  }
  function down(on){ player.crouch = on && player.onGround; }

  zoneR.addEventListener('touchstart', e=>{ e.preventDefault(); jump(); }, {passive:false});
  zoneR.addEventListener('pointerdown', e=>{ if(e.pointerType!=='touch') jump(); });

  zoneL.addEventListener('touchstart', e=>{ e.preventDefault(); down(true); }, {passive:false});
  zoneL.addEventListener('touchend', e=>{ e.preventDefault(); down(false); }, {passive:false});
  zoneL.addEventListener('pointerdown', e=>{ if(e.pointerType!=='touch') down(true); });
  zoneL.addEventListener('pointerup',   e=>{ if(e.pointerType!=='touch') down(false); });

  addEventListener('keydown', e=>{
    if(e.code==='Space'||e.code==='ArrowUp'||e.code==='KeyW') jump();
    if(e.code==='ArrowDown'||e.code==='KeyS') down(true);
    if(e.code==='KeyP') togglePause();
  });
  addEventListener('keyup', e=>{ if(e.code==='ArrowDown'||e.code==='KeyS') down(false); });

  // ======= UI bot√µes =======
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const muteBtn  = document.getElementById('muteBtn');
  const overlay = document.getElementById('overlay');
  const bar = document.getElementById('bar');
  const scoreTag = document.getElementById('scoreTag');
  const bestTag = document.getElementById('bestTag');
  const speedTag = document.getElementById('speedTag');

  bestTag.textContent = `‚≠ê ${state.best}`;

  let fakeLoad = 0; const loadTimer = setInterval(()=>{ fakeLoad = clamp(fakeLoad + rand(5,14), 0, 100); bar.style.width = fakeLoad+'%'; if(fakeLoad>=100) clearInterval(loadTimer); }, 120);

  startBtn.addEventListener('click', startGame);
  pauseBtn.addEventListener('click', togglePause);
  resetBtn.addEventListener('click', ()=>{ gameOver(true); startGame(); });
  muteBtn.addEventListener('click', ()=>{ state.muted=!state.muted; muteBtn.textContent = state.muted? 'üîá Sem som' : 'üîä Som'; });

  function startGame(){
    overlay.style.display='none';
    Object.assign(state,{ running:true, paused:false, t:0, last:performance.now(), dt:0, score:0, speedMul:1 });
    Object.assign(player,{ x:72, y:state.groundY-48, w:36, h:48, vy:0, onGround:true, crouch:false, doubleReady:true });
    obstacles.length=0; orbs.length=0; particles.length=0;
    spawnTimer=0; orbTimer=1.2;
    beep(600,0.05,'sine');
    loop();
  }

  function togglePause(){
    if(!state.running) return;
    state.paused = !state.paused;
    pauseBtn.textContent = state.paused? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
    if(!state.paused){ state.last = performance.now(); loop(); }
  }

  function gameOver(reset=false){
    state.running=false; state.paused=false;
    if(!reset){
      overlay.style.display='flex';
      overlay.querySelector('.title').textContent = 'Fim de Jogo üí•';
      overlay.querySelector('.muted').innerHTML = `Pontua√ß√£o: <b>${Math.floor(state.score)}</b><br>Toque em "Come√ßar" para jogar novamente.`;
      beep(200,0.12,'square'); vibe(30);
    }
    if(state.score>state.best){ state.best = Math.floor(state.score); localStorage.setItem('bestScoreRF', state.best); }
    bestTag.textContent = `‚≠ê ${state.best}`;
  }

  // ======= Spawn =======
  let spawnTimer=0; let orbTimer=0;
  function spawnObstacle(){
    const h = rand(28,60), w = rand(24,42);
    const type = Math.random()<0.25 ? 'flying' : 'block';
    const y = type==='block'? state.groundY - h : state.groundY - h - rand(120,200);
    const color = type==='block'? '#a78bfa' : '#34d399';
    obstacles.push({ x: state.width + rand(0,40), y, w, h, color, type });
  }
  function spawnOrb(){
    const size = 16; const y = rand(state.groundY-200, state.groundY-80);
    orbs.push({ x: state.width + 10, y, w:size, h:size, color:'#fde68a' });
  }

  // ======= Atualiza√ß√£o =======
  function update(dt){
    // velocidade escala com o tempo
    state.speedMul = 1 + Math.min(1.2, state.t/35000);
    const vx = (state.speed * state.speedMul) * dt;

    // ch√£o / gravidade
    player.vy += state.gravity * dt;
    player.y += player.vy * dt;

    const targetH = player.crouch && player.onGround ? 30 : 48;
    player.h += (targetH - player.h) * 10*dt; // anima√ß√£o suave

    // ch√£o
    if(player.y + player.h >= state.groundY){ player.y = state.groundY - player.h; player.vy=0; player.onGround=true; }
    else player.onGround=false;

    // mover e remover obst√°culos
    for(let i=obstacles.length-1;i>=0;i--){
      const o = obstacles[i]; o.x -= vx;
      if(o.x + o.w < -2) obstacles.splice(i,1);
      else if(rectsOverlap(player,o)) gameOver();
    }

    // orbes
    for(let i=orbs.length-1;i>=0;i--){
      const o = orbs[i]; o.x -= vx;
      if(o.x + o.w < -2) orbs.splice(i,1);
      else if(rectsOverlap(player,o)){ state.score += 5; orbs.splice(i,1); vibe(8); beep(1000,0.05,'sine'); }
    }

    // part√≠culas simples na trilha do player
    if(Math.random()<0.5){
      particles.push({x:player.x+player.w*0.5, y:player.y+player.h, r:rand(1,3), alpha:0.6});
    }
    for(let i=particles.length-1;i>=0;i--){
      const p = particles[i]; p.y += 60*dt; p.alpha -= 1.5*dt; if(p.alpha<=0) particles.splice(i,1);
    }

    // spawn timers
    spawnTimer -= dt; if(spawnTimer<=0){ spawnObstacle(); spawnTimer = rand(0.9,1.45) / state.speedMul; }
    orbTimer -= dt; if(orbTimer<=0){ spawnOrb(); orbTimer = rand(1.2,2.4) / state.speedMul; }

    // pontua√ß√£o
    state.score += 10 * dt * state.speedMul;
    scoreTag.textContent = `üèÜ ${Math.floor(state.score)}`;
    speedTag.textContent = `‚ö° ${state.speedMul.toFixed(2)}x`;
  }

  // ======= Render =======
  function draw(){
    const w=state.width, h=state.height;
    ctx.clearRect(0,0,w,h);

    // c√©u com paralaxe
    const t = state.t*0.0003*state.speedMul;
    for(let i=0;i<3;i++){
      ctx.globalAlpha = 0.12 + i*0.07; ctx.fillStyle = ['#22d3ee','#a78bfa','#34d399'][i];
      const bw = 180*(i+1); const y = h*0.18 + i*22;
      for(let x=-bw; x<w+bw; x+=bw){
        const offset = (x - (t*(40*(i+1))%bw));
        ctx.beginPath(); ctx.arc(offset, y, 2+i*1.6, 0, Math.PI*2); ctx.fill();
      }
    }
    ctx.globalAlpha = 1;

    // ch√£o
    ctx.fillStyle = '#0b1222';
    ctx.fillRect(0, state.groundY, w, h - state.groundY);
    // faixa do ch√£o
    ctx.fillStyle = '#0e1930';
    for(let x=0;x<w;x+=24){ ctx.fillRect((x - (state.t*0.3)%24), state.groundY-4, 12, 2); }

    // player
    ctx.save();
    ctx.translate(Math.round(player.x), Math.round(player.y));
    // corpo
    ctx.fillStyle = player.color;
    ctx.fillRect(0,0, player.w, player.h);
    // detalhe rosto
    ctx.fillStyle = '#0b1020';
    ctx.fillRect(6,8,8,8);
    ctx.restore();

    // obst√°culos
    obstacles.forEach(o=>{
      ctx.fillStyle = o.color; ctx.fillRect(Math.round(o.x), Math.round(o.y), o.w, o.h);
    });

    // orbes
    orbs.forEach(o=>{
      ctx.beginPath(); ctx.fillStyle = o.color; ctx.arc(Math.round(o.x+o.w/2), Math.round(o.y+o.h/2), o.w/2, 0, Math.PI*2); ctx.fill();
    });

    // part√≠culas
    particles.forEach(p=>{ ctx.globalAlpha = p.alpha; ctx.fillStyle = '#22d3ee'; ctx.fillRect(p.x, p.y, p.r, p.r); ctx.globalAlpha = 1; });
  }

  // ======= Loop =======
  function loop(now=performance.now()){
    if(!state.running || state.paused) return;
    state.dt = Math.min(0.033, (now - state.last)/1000);
    state.last = now; state.t += (state.dt*1000);
    update(state.dt); draw();
    requestAnimationFrame(loop);
  }

})();
</script>
</body>
</html>